---
- import_tasks: 'reset.yml'

- name: Create
  panos_application_object:
    provider: '{{ device }}'
    name: 'custom-app'
    category: 'business-systems'
    subcategory: 'auth-service'
    technology: 'client-server'
    risk: '1'
  register: result

- name: Assert create was successful
  assert:
    that:
      - result is success
      - result is changed

- name: Create (idempotence)
  panos_application_object:
    provider: '{{ device }}'
    name: 'custom-app'
    category: 'business-systems'
    subcategory: 'auth-service'
    technology: 'client-server'
    risk: '1'
  register: result

- name: Assert create (idempotence) was successful
  assert:
    that:
      - result is success
      - result is not changed

- name: Modify
  panos_application_object:
    provider: '{{ device }}'
    name: 'custom-app'
    category: 'business-systems'
    subcategory: 'auth-service'
    technology: 'client-server'
    risk: '5'
  register: result

- name: Assert modify was successful
  assert:
    that:
      - result is success
      - result is changed

- name: Delete
  panos_application_object:
    provider: '{{ device }}'
    name: 'custom-app'
    state: 'absent'
  register: result

- name: Assert delete was successful
  assert:
    that:
      - result is success
      - result is changed

- name: Make sure changes commit cleanly
  panos_commit:
    provider: '{{ device }}'
  register: result

- name: Assert commit was successful
  assert:
    that:
      - result is success

- import_tasks: 'reset.yml'
  when: reset_after_test|bool